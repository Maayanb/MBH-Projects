<!DOCTYPE html>
<html>
<head>
    <title>Chumpi Bounce ‚Äì Catch the Cookies</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <style>
        body {
            text-align: center;
            background-color: white;
            color: black;
            margin: 0;
            padding: 0;
            overflow: hidden;
            font-family: Arial, sans-serif;
            touch-action: manipulation;
        }
        #gameContainer {
            position: relative;
            width: 100%;
            height: 100vh;
            overflow: hidden;
        }
        #gameInfo {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            z-index: 10;
            background-color: rgba(255, 255, 255, 0.7);
            padding: 5px 0;
        }
        h1 {
            margin: 5px 0;
            font-size: 6vw;
        }
        p {
            margin: 5px 0;
            font-size: 4vw;
        }
        canvas {
            background-color: white;
            display: block;
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
        }
        #restartButton {
            display: none;
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            padding: 10px 20px;
            font-size: 5vw;
            cursor: pointer;
            background-color: #4CAF50;
            color: white;
            border: none;
            border-radius: 5px;
            z-index: 20;
        }
        #touchToJump {
            position: absolute;
            bottom: 20px;
            width: 100%;
            text-align: center;
            font-size: 4vw;
            color: rgba(0, 0, 0, 0.5);
            z-index: 10;
        }
    </style>
</head>
<body>
    <div id="gameContainer">
        <div id="gameInfo">
            <h1>Chumpi Bounce</h1>
            <p>Catch cookies! üç™ Score: <span id="score">0</span></p>
        </div>
        <canvas id="gameCanvas"></canvas>
        <div id="touchToJump">Tap anywhere to jump</div>
        <button id="restartButton" onclick="restartGame()">Play Again?</button>
    </div>
    
    <script>
        const canvas = document.getElementById("gameCanvas");
        const ctx = canvas.getContext("2d");
        const scoreDisplay = document.getElementById("score");
        const restartButton = document.getElementById("restartButton");
        const touchToJump = document.getElementById("touchToJump");
        
        // Set actual pixel dimensions for the canvas
        function resizeCanvas() {
            // Get the device pixel ratio
            const dpr = window.devicePixelRatio || 1;
            
            // Get the size of the canvas in CSS pixels
            const rect = canvas.getBoundingClientRect();
            
            // Set the canvas dimensions considering the device pixel ratio
            canvas.width = rect.width * dpr;
            canvas.height = rect.height * dpr;
            
            // Scale the context to ensure correct drawing operations
            ctx.scale(dpr, dpr);
            
            // Update game elements if needed
            if (player) {
                player.x = rect.width / 2;
                player.y = rect.height - 80;
            }
        }
        
        window.addEventListener("resize", resizeCanvas);
        
        // Load the original sloth image
        const slothImage = new Image();
        slothImage.src = 'https://tse3.mm.bing.net/th?id=OIP.wZX54TSHH67ayJTNR0caaQHaHa&pid=Api';
        
        let player = {
            x: 0,
            y: 0,
            size: 60,
            dy: 0,
            gravity: 0.5,
            jumpStrength: -7,
            image: slothImage,
            isJumping: false
        };

        let score = 0;
        let cookies = [];
        let gameRunning = true;
        let gameInitialized = false;
        
        // Initialize the game after everything is loaded
        function init() {
            if (gameInitialized) return;
            gameInitialized = true;
            
            resizeCanvas();
            
            // Reset player position based on new canvas size
            const rect = canvas.getBoundingClientRect();
            player.x = rect.width / 2;
            player.y = rect.height - 80;
            
            // Start game loop
            update();
            
            // Start cookie generation
            startCookieGeneration();
        }

        function drawPlayer() {
            const rect = canvas.getBoundingClientRect();
            // Calculate size based on screen dimensions
            player.size = Math.min(rect.width, rect.height) * 0.15;
            
            ctx.drawImage(
                player.image, 
                player.x - player.size / 2, 
                player.y - player.size / 2, 
                player.size, 
                player.size
            );
        }

        function drawCookies() {
            ctx.font = `${Math.min(canvas.getBoundingClientRect().width, canvas.getBoundingClientRect().height) * 0.1}px Arial`;
            cookies.forEach(cookie => {
                ctx.fillText("üç™", cookie.x, cookie.y);
            });
        }

        function moveCookies() {
            if (!gameRunning) return;
            
            const rect = canvas.getBoundingClientRect();
            const speedFactor = rect.width / 400; // Adjust speed based on screen width
            
            cookies.forEach(cookie => {
                cookie.x -= cookie.speed * speedFactor;
            });
            cookies = cookies.filter(cookie => cookie.x > -100);
        }

        function checkCollision() {
            const cookieSizeApprox = Math.min(canvas.getBoundingClientRect().width, canvas.getBoundingClientRect().height) * 0.05;
            
            for (let i = cookies.length - 1; i >= 0; i--) {
                const cookie = cookies[i];
                const distance = Math.hypot(player.x - cookie.x, player.y - cookie.y);
                
                if (distance < (player.size / 2 + cookieSizeApprox) && !cookie.hit) {
                    cookie.hit = true;
                    score++;
                    scoreDisplay.textContent = score;
                    player.dy = player.jumpStrength;
                    cookies.splice(i, 1);
                }
            }
        }

        function update() {
            if (!gameRunning) return;
            
            const rect = canvas.getBoundingClientRect();
            ctx.clearRect(0, 0, rect.width, rect.height);
            
            drawPlayer();
            drawCookies();

            player.y += player.dy;
            player.dy += player.gravity;

            // Ground collision
            if (player.y > rect.height - 80) {
                player.y = rect.height - 80;
                player.dy = 0;
                player.isJumping = false;
            }

            moveCookies();
            checkCollision();
            requestAnimationFrame(update);
        }

        function jump() {
            if (!player.isJumping) {
                player.dy = player.jumpStrength;
                player.isJumping = true;
            }
        }

        function startCookieGeneration() {
            setInterval(() => {
                if (!gameRunning) return;
                
                const rect = canvas.getBoundingClientRect();
                let yPosition = Math.random() * (rect.height - 200);
                if (yPosition < 100) yPosition = 100;
                
                const speedFactor = rect.width / 400;
                cookies.push({ 
                    x: rect.width, 
                    y: yPosition, 
                    speed: (3 + Math.random() * 2) * speedFactor, 
                    hit: false 
                });
            }, 1500);
        }

        function restartGame() {
            score = 0;
            scoreDisplay.textContent = "0";
            cookies = [];
            
            const rect = canvas.getBoundingClientRect();
            player.x = rect.width / 2;
            player.y = rect.height - 80;
            player.dy = 0;
            
            gameRunning = true;
            restartButton.style.display = "none";
            touchToJump.style.display = "block";
            
            update();
            startCookieGeneration();
        }

        // Jump controls
        document.addEventListener("keydown", function(event) {
            if (event.key === " " && gameRunning) {
                jump();
            }
        });
        
        // Handle both touch and mouse clicks
        canvas.addEventListener("touchstart", function(event) {
            event.preventDefault();
            if (gameRunning) jump();
        });
        
        canvas.addEventListener("mousedown", function(event) {
            if (gameRunning) jump();
        });
        
        // Initialize once the sloth image is loaded
        slothImage.onload = init;
        
        // Fallback init in case the image loading is delayed
        window.onload = function() {
            setTimeout(init, 1000);
        };
    </script>
</div>
</body>
</html>
